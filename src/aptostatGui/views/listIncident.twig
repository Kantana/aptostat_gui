<ul>
    {% if showHidden == 'true' %}
        {% for incident in incidentList %}

            {% set criticalsExist = 0 %}
            {% set warningsExist = 0 %}

            {% if incident["lastStatus"] == "WARNING" %}
                {% set warningsExist = 1 %}
            {% elseif incident["lastStatus"] == "CRITICAL" %}
                {% set criticalsExist = 1 %}
            {% endif %}

            {% if criticalsExist == 1 %}
                {% set titleImage = "../img/cross.png" %}
            {% elseif warningsExist == 1 %}
                {% set titleImage = "../img/warning.png" %}
            {% else %}
                {% set titleImage = "../img/check.png" %}
            {% endif %}

            {% if warningsExist == 0 and criticalsExist == 0 %}
                {% set titleErrorString = "All responding" %}
            {% elseif incident['connectedReports']|length > 1 %}
                {% set titleErrorString = incident['connectedReports']|length ~ " reports" %}
            {% else %}
                {% set titleErrorString = "1 report" %}
            {% endif %}

            <li class='incident file' id='incident_{{ incident["id"] }}'>Incident {{ incident['id'] }}: {{ incident["title"] }} <span class="label label-info">{{ titleErrorString }}</span> <img class='right' src='{{ titleImage }}' /> </li>
        {% endfor %}
    {% else %}
        {% for incident in incidentList %}
            {% if incident['hidden'] == false %}

                {% set criticalsExist = 0 %}
                {% set warningsExist = 0 %}

                {% if incident["lastStatus"] == "WARNING" %}
                    {% set warningsExist = 1 %}
                {% elseif incident["lastStatus"] == "CRITICAL" %}
                    {% set criticalsExist = 1 %}
                {% endif %}

                {% if criticalsExist == 1 %}
                    {% set titleImage = "../img/cross.png" %}
                {% elseif warningsExist == 1 %}
                    {% set titleImage = "../img/warning.png" %}
                {% else %}
                    {% set titleImage = "../img/check.png" %}
                {% endif %}

                {% if warningsExist == 0 and criticalsExist == 0 %}
                    {% set titleErrorString = "All responding" %}
                {% elseif incident['connectedReports']|length > 1 %}
                    {% set titleErrorString = incident['connectedReports']|length ~ " reports" %}
                {% else %}
                    {% set titleErrorString = "1 report" %}
                {% endif %}

                <li class='incident file' id='incident_{{ incident["id"] }}'>Incident {{ incident['id'] }}: {{ incident["title"] }} <span class="label label-info">{{ titleErrorString }}</span> <img class='right' src='{{ titleImage }}' /> </li>
            {% endif %}
        {% endfor %}
    {% endif %}
</ul>
<script>
    $(".incident").on("click", function clickIncident() {
        var incidentId = $(this).attr("id");
        incident = incidentId.replace("incident_", "");
        $("#reportPane").css("opacity", "0");
        $("#reportPane").load("ajax/viewIncident", {"incident": incident}, function(response, status, xhr) {
            if (status == "error") {
                var msg = "Error: ";
                $("#reportPane").html(msg + xhr.status + " " + xhr.statusText);
            }
            else {
                $("#reportPane").fadeTo("normal",1);
            }
        });
        $('#newMessage').show();
    });
</script>